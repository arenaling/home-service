{"version":3,"sources":["../../../../server/api/sale/sale.controller.js"],"names":[],"mappings":"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","file":"sale.controller.js","sourcesContent":["/**\n * Using Rails-like standard naming convention for endpoints.\n * GET     /api/sales              ->  index\n * POST    /api/sales              ->  create\n * GET     /api/sales/:id          ->  show\n * PUT     /api/sales/:id          ->  update\n * DELETE  /api/sales/:id          ->  destroy\n */\n\n'use strict';\n\nimport _ from 'lodash';\nimport {Sale} from '../../sqldb';\n\nvar path = require('path');\n\nfunction respondWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\nfunction saveUpdates(updates) {\n  return function(entity) {\n    return entity.updateAttributes(updates)\n      .then(updated => {\n        return updated;\n      });\n  };\n}\n\nfunction removeEntity(res) {\n  return function(entity) {\n    if (entity) {\n      return entity.destroy()\n        .then(() => {\n          res.status(204).end();\n        });\n    }\n  };\n}\n\nfunction handleEntityNotFound(res) {\n  return function(entity) {\n    if (!entity) {\n      res.status(404).end();\n      return null;\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    console.log(err);\n    res.status(statusCode).send(err);\n  };\n}\n\n// Gets a list of Sales\nexport function index(req, res) {\n  var query = req.query;\n  var limit = 10;\n\n  if(typeof query.status !== 'undefined' && query.status != \"\") {\n    if(query.status == 1) {\n      query.status = 'Belum Diverifikasi';\n    } else if(query.status == 2) {\n      query.status = 'Sudah Diverifikasi';\n      query.hasil_verifikasi = {$ne: 'NOT OK'};\n    }\n  }\n\n  if(typeof query.tanggal !== 'undefined' && query.tanggal != \"\") {\n    query.tanggal_penyerahan = {$gte: \"\"+query.tanggal+\" 00:00:00\", $lte: \"\"+query.tanggal+\" 23:59:59\"};\n    delete query.tanggal;\n  }\n\n  if(typeof query.page !== 'undefined' && query.page != \"\") {\n    var page = query.page;\n    var offset = ((page - 1) * limit);\n    delete query.page;\n\n    return Sale.findAll({where: req.query, order: \"updatedAt DESC\", limit: limit, offset: offset})\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n  } else {\n    return Sale.findAll({where: req.query})\n      .then(respondWithResult(res))\n      .catch(handleError(res));\n  }\n}\n\n// Gets a count of Sales\nexport function count(req, res) {\n  var query = req.query;\n\n  if(typeof query.status !== 'undefined' && query.status != \"\") {\n    if(query.status == 1) {\n      query.status = 'Belum Diverifikasi';\n    } else if(query.status == 2) {\n      query.status = 'Sudah Diverifikasi';\n      query.hasil_verifikasi = {$ne: 'NOT OK'};\n    }\n  }\n\n  if(typeof query.page !== 'undefined' && query.page != \"\") {\n    delete query.page;\n  }\n\n  if(typeof query.tanggal !== 'undefined' && query.tanggal != \"\") {\n    query.tanggal_penyerahan = {$gte: \"\"+query.tanggal+\" 00:00:00\", $lte: \"\"+query.tanggal+\" 23:59:59\"};\n    delete query.tanggal;\n  }\n\n  return Sale.count({where: req.query})\n    .then(function(count) {\n      var statusCode = 200;\n\n      var ret = {\"count\": count};\n\n      res.status(statusCode).json(ret);\n    })\n    .catch(handleError(res));\n}\n\n// Gets a single Sale from the DB\nexport function show(req, res) {\n  return Sale.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Creates a new Sale in the DB\nexport function create(req, res) {\n  return Sale.create(req.body)\n    .then(respondWithResult(res, 201))\n    .catch(handleError(res));\n}\n\n// Updates an existing Sale in the DB\nexport function update(req, res) {\n  if (req.body._id) {\n    delete req.body._id;\n  }\n  return Sale.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(saveUpdates(req.body))\n    .then(respondWithResult(res))\n    .catch(handleError(res));\n}\n\n// Deletes a Sale from the DB\nexport function destroy(req, res) {\n  return Sale.find({\n    where: {\n      _id: req.params.id\n    }\n  })\n    .then(handleEntityNotFound(res))\n    .then(removeEntity(res))\n    .catch(handleError(res));\n}\n\nfunction saveFile(res, file) {\n  return function(entity){\n    var newPath = '/assets/uploads/' + path.basename(file.path);\n    entity.file_ktp = newPath;\n    return entity.save();//.spread(function(updated) {\n    //   console.log(updated);\n    //   return updated;\n    // });\n  }\n}\n\nfunction responseWithResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (entity) {\n      res.status(statusCode).json(entity);\n    }\n  };\n}\n\n// Uploads a new Sale's image in the DB\nexports.upload = function(req, res) {\n  var file = req.files.file;\n  if(!file){\n    return handleError(res)('File not provided');\n  }\n\n  Sale.findById(req.params.id)\n    .then(handleEntityNotFound(res))\n    .then(saveFile(res, file))\n    .then(responseWithResult(res))\n    .catch(handleError(res));\n};\n"]}